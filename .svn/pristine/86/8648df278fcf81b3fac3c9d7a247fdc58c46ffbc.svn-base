import React, { useState} from 'react'
import {Button, Upload, Icon, message} from 'antd'
import { get } from 'lodash'
import Dialog, {withLazy} from '@/components/Dialog'
import  fetch from '@/services/axios'


const UploadExaminee= (props) => {
  const { title, uploadAPI, onCancel} = props
  const [fileList, setFileList] = useState([])
  const handleUpload = () => {
    console.log(' 批量导入')
    console.log(fileList)
    if(!fileList.length) {
      message.error('请上传文件')
    }  else {
      let formData = new FormData()
      console.log(fileList)
      formData.append('data', fileList[0])
      console.log(uploadAPI)
      fetch.post(uploadAPI, formData).then(res => {
        if(get(res, 'state') === 10000) {
          message.info(get(res, 'message'))
          setFileList([])
          onCancel()
        } else if(get(res, 'state') === -1){
          message.info(get(res, 'message'))
        }
      })
    }
    
  }
  const uploadProps = {
    onRemove : file => {
      setFileList([])
    },
    beforeUpload: file => {
      console.log(file)
      setFileList([file])
      return false
    },
    fileList
  }
  return (<Dialog title={title} {...props} onOk={handleUpload}>
  <>
    <Upload {...uploadProps} >
         <Button><Icon type="upload" /> 请选择文件夹 </Button>
    </Upload>
   
  </>
  </Dialog>)
}


UploadExaminee.defaultProps = {
  width: '500px',
  title: '考生批量导入'
}
export default withLazy(UploadExaminee) 